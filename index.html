// motor_de_reglas.js

// Lista base de reglas
export const reglas = [
  {
    nombre: "Generar relleno completo",
    dependeDe: [],
    condiciones: () => true, // Siempre puede ejecutarse
    ejecutar: () => {
      console.log("âœ” Ejecutando: Generar relleno completo");
      // AquÃ­ se llamarÃ­a la funciÃ³n real de generaciÃ³n de relleno
    },
    sugerencias: []
  },
  {
    nombre: "Reubicar palabras clave",
    dependeDe: ["Generar relleno completo"],
    condiciones: () => {
      // AquÃ­ puedes verificar si ya hay relleno generado, por ejemplo
      return true; // SimulaciÃ³n
    },
    ejecutar: () => {
      console.log("âœ” Ejecutando: Reubicar palabras clave");
      // AquÃ­ se llamarÃ­a la funciÃ³n real para reubicar palabras
    },
    sugerencias: ["AsegÃºrate de generar el relleno completo antes de reubicar."]
  },
  {
    nombre: "Validar relleno antes y despuÃ©s de palabras clave",
    dependeDe: ["Reubicar palabras clave"],
    condiciones: () => {
      const rellenoCorrecto = false; // SimulaciÃ³n de fallo
      return rellenoCorrecto;
    },
    ejecutar: () => {
      console.log("âœ” ValidaciÃ³n exitosa: Hay relleno antes y despuÃ©s de cada palabra clave.");
    },
    sugerencias: [
      "Verifica que cada palabra clave estÃ© rodeada de palabras de relleno.",
      "Tal vez necesites revisar el script de alineaciÃ³n para que no elimine el relleno anterior."
    ]
  }
];

// FunciÃ³n para ejecutar las reglas en orden con validaciÃ³n de dependencias
export function ejecutarReglas(reglas) {
  const ejecutadas = new Set();

  function ejecutarConDependencias(regla) {
    for (const dep of regla.dependeDe) {
      const dependencia = reglas.find(r => r.nombre === dep);
      if (dependencia && !ejecutadas.has(dep)) {
        ejecutarConDependencias(dependencia);
      }
    }

    if (!ejecutadas.has(regla.nombre)) {
      if (regla.condiciones()) {
        regla.ejecutar();
        ejecutadas.add(regla.nombre);
      } else {
        console.warn(`âŒ No se ejecutÃ³: ${regla.nombre}`);
        if (regla.sugerencias?.length) {
          console.info("ðŸ’¡ Sugerencias:");
          regla.sugerencias.forEach(s => console.info(`- ${s}`));
        }
      }
    }
  }

  console.group("ðŸ”Ž Verificando reglas del sistema");
  reglas.forEach(regla => ejecutarConDependencias(regla));
  console.groupEnd();
}